<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Stoutmuur</title>
    <link rel="stylesheet" href="default.css">
</head>

<body>
<button>Vernieuwen</button>
</body>

<script src="http://d3js.org/d3.v3.js"></script>
<script src="muur.js"></script>

<script>
var dikte = 5;

var strek = 0, kop = 1, drieklezoor = 3, uitstekend = 4;

var size = {
    dikte: dikte,
    lagenmaat: dikte + 1,
    stones: [
        {dx:   21 + 1, w:   21, name: 'strek'}, // 0
        {dx:   10 + 1, w:   10, name: 'kop'}, // 1
        {dx:  4.5 + 1, w:  4.5, name: 'klisklezoor'}, // 2
        {dx: 15.5 + 1, w: 15.5, name: 'drieklezoor'}, // 3
        {dx:   10 + 1, w:   10, name: 'kop-uitstekend'} // 4
    ]
};

var muurhoogte = 200;
var lagen = muurhoogte / size.lagenmaat;
var muur_gerealiseerd = 49;


function halfsteens(breedte, lagen) {
    return d3.range(0, lagen).map(function (i) {
        var laag = d3.range(0, breedte - 1).map(function () { return 0; });
        if (i % 2 == 0) {
            laag.unshift(1);
        } else {
            laag.push(1);
        }
        return laag;
    });
}

var kruis = function (breedte, lagen) {
    return d3.range(0, lagen).map(function (i) {
        if (i % 2 == 0) {
            return d3.range(0, breedte * 2 - 1).map(function () { return 1; });
        } else {
            return [2].concat(d3.range(0, breedte - 1).map(function () { return 0; })).concat([2]);
        }
    });
};
var rand = function (a, b) { return Math.floor(Math.random() * b + 1) - 1; };


var super_random = function (breedte, lagen) {
    return d3.range(0, lagen).map(function (i) {
        var laag = d3.range(0, breedte).map(function (j) { return rand(0, 2); });
        if (i % 2 == 0) {
            laag.unshift(2);
        }
        return laag;
    });
};

function is_protruding(laag) {
    var hoogte = laag * size.lagenmaat;
    var normalized = (hoogte - muur_gerealiseerd) / (muurhoogte - muur_gerealiseerd);

    if (hoogte < muur_gerealiseerd) {
        return true;
    }
    return Math.random() < (normalized + 0.10) / 4;
}

function randomize_koppen(muur) {
    return muur.map(function (row, i) {
        // bestaande muur, niks aan doen
        if (i < muur_gerealiseerd / size.lagenmaat) { return row; }

        var num_protruding = 0;
        return row.map(function (s) {
            if (s == 1 && num_protruding < 2 && is_protruding(i)) {
                num_protruding++;
                return 4;
            }
            num_protruding = 0;
            return s;
        });
    });
}

function randomize_halfsteens(muur) {
    for (var i = 0; i < muur.length; i++) {
        var row = muur[i];
        // bestaande muur, niks aan doen
        if (i < muur_gerealiseerd / size.lagenmaat) { continue; }

        var num_protruding = 0;
        for (var j = 0; j <= row.length; j++) {
            var s = row[j];
            if (s == 0 && num_protruding < 2 && is_protruding(i)) {
                // vervang deze streksteen met twee kopse waarvan 1 uitstekend.
                if (Math.random() < 0.5) {
                    muur[i].splice(j, 1, kop, uitstekend);
                } else {
                    muur[i].splice(j, 1, uitstekend, kop);
                }
                num_protruding++;
                continue;
            }
            num_protruding = 0;
        }
    }
    return muur;
}
var p = plot('randomized halfsteens', size);

var genereer = function () {
    p.render(randomize_halfsteens(halfsteens(32, lagen)));
};

genereer();

d3.select('button').on('click', genereer);





</script>
</html>
